{% load static %}

<div class="box">
    <div class="d-flex flex-row">
        
        {% if media.response.main_picture.large %}
            <img class="poster" src={{media.response.main_picture.large}}>
        {% elif media.response.poster_path %}
            <img class="poster" src="https://image.tmdb.org/t/p/w500{{media.response.poster_path}}">
        {% else %}
            <img class="image-not-found" src="{% get_media_prefix %}/images/none.svg">
        {% endif %}

        <div class="content">

            {% if media.response.start_date or media.response.release_date%}
                <div class="date">
                    <strong>Release date:</strong>
                    {{media.response.start_date}}
                    {{media.response.release_date}}
                </div>
            {% endif %}

            <div class="overview">
                <strong>Overview:</strong>
                {% if media.response.synopsis %} {{media.response.synopsis}} 
                {% elif media.response.overview %} {{media.response.overview}} 
                {% else %} No synopsis available
                {% endif %}
            </div>
            
            {% if media.response.number_of_seasons %}
            <div class="num_seasons">
                <strong>Seasons:</strong> {{media.response.number_of_seasons}}
            </div>
            {% endif %}
            <div class="episodes">
                {% if media.response.num_episodes %} <strong>Episodes:</strong> {{media.response.num_episodes}}
                {% elif media.response.num_chapters %} <strong>Chapters:</strong> {{media.response.num_chapters}}
                {% elif media.response.number_of_episodes %} <strong>Episodes:</strong> {{media.response.number_of_episodes}}
                {% else %} <strong>Chapters:</strong> 1
                {% endif %}
            </div>
            
            {% if media.response.duration %}
                <div class="runtime">
                    <strong>Runtime:</strong> {{media.response.duration}}
                </div>
            {% endif %}

            <div class="media-status">
                <strong>Status:</strong>
                {% if media.response.status %} {{media.response.status}} 
                {% else %} N/A. 
                {% endif %}
            </div>

            <div class="genres">
                <strong>Genres:</strong>
                {% if media.response.genres%}
                    {% for genre in media.response.genres %}
                        {{ genre.name }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                {% else %} N/A.
                {% endif %}
            </div>
        </div>
    </div>


    <form class="d-flex mt-4 flex-wrap" method="post" id="form-{{media.response.media_type}}_{{media.response.id}}">
        {% csrf_token %}

        {% if media.response.number_of_seasons and media.response.number_of_seasons != 1 %}
        <div>
            <div class="descriptor">Season</div>
            <select required name="season" class="form-select form-season" id="season-select-{{media.response.media_type}}_{{media.response.id}}">
                {% load extras %}
                    <option value="" disabled selected hidden>Select</option>
                    <option value="all">All</option>
                {% for i in media.response.number_of_seasons|times %}
                    <option value="{{forloop.counter}}">S{{forloop.counter}}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <div>
            <div class="descriptor">Status</div>
            <select name="status" class="form-select" id="season-status-{{media.response.media_type}}_{{media.response.id}}">
                <option value="Completed" {% if media.database.status == "Completed" %}selected{% endif %}>Completed</option>
                <option value="Planning" {% if media.database.status == "Planning" %}selected{% endif %}>Planning</option>
                <option value="Watching" {% if media.database.status == "Watching" %}selected{% endif %}>Watching</option>
                <option value="Paused" {% if media.database.status == "Paused" %}selected{% endif %}>Paused</option>
                <option value="Dropped" {% if media.database.status == "Dropped" %}selected{% endif %}>Dropped</option>
            </select>
        </div>
        
        <div class="flex-grow-1">
            <div class="descriptor">Score</div>
            <input type="number" id="score-input-{{media.response.media_type}}_{{media.response.id}}" class="form-control bg-dark text-white" name="score" value="{{media.database.score}}" step="0.1" min="0" max="10">
        </div>
        
        <div class="flex-grow-1">
            <div class="descriptor">Progress</div>
            <input type="number" id="progress-input-{{media.response.media_type}}_{{media.response.id}}" class="form-control bg-dark text-white" name="progress" value="{{media.database.progress}}" step="1" min="0">
        </div>

        <div class="flex-grow-1">
            <div class="descriptor">Start Date</div>
            <input type="date" id="start-input-{{media.response.media_type}}_{{media.response.id}}" class="form-control bg-dark text-white" name="start" value="{{media.database.start_date}}">
        </div>

        <div class="flex-grow-1">
            <div class="descriptor">End Date</div>
            <input type="date" id="end-input-{{media.response.media_type}}_{{media.response.id}}" class="form-control bg-dark text-white" name="end" value="{{media.database.end_date}}">
        </div>
    </form>
      
      
</div>