{% extends "base.html" %}
{% load static %}

{% block content %}
{% if watching|length == 0 %}
  <div class="not-found">
    <div>
      <h2 class="alert-heading text-center">No media in progress</h2>
      <p>The homepage will show the media you are currently consuming.</p>
    </div>
  </div>
  {% else %}
    <div id="home">

      {% for media_type, watching_list in watching.items %}
        <div class="container">
          <div class="title">{{ media_type|capfirst }} in Progress</div>
          <div class="grid">
            {% for media in watching_list %}
              <div class="card text-bg-dark mx-auto">
                <a {% if media.season_number != None %}
                      href="{% url 'season_details' media_id=media.media_id title=media.title|slugify season_number=media.season_number %}">
                    {% else %}
                      href="{% url 'media_details' media_type=media_type media_id=media.media_id title=media.title|slugify %}">
                  {% endif %}
                  <img
                    data-src="{{ media.image.url }}"
                    {% if media.image.url == "/media/none.svg"%}
                      class="card-img open-modal-button lazyload image-not-found"
                      {% else %}
                      class="card-img open-modal-button lazyload poster"
                    {% endif %}
                    alt="{{ media.title }}"
                    data-expand="1000"
                  />
                </a>

                <div class="card-img-overlay">
                  <div class="card-title text-center">
                    {{ media.title }}
                    {% if media.season_number != None %}
                      S{{ media.season_number }}
                    {% endif %}
                  </div>
                  <div class="card-text d-flex justify-content-center align-items-center" id="{{media_type}}_{{media.media_id}}{% if media.season_number != None %}_{{media.season_number}}{% endif %}">
                    <button type="button" class="btn progress-btn border-0" data-operation="decrease"
                            data-type="{{media_type}}" data-id="{{media.media_id}}"
                            {% if media.season_number != None %} data-season-number="{{media.season_number}}" {% endif %}
                            {% if media.progress == 0 %} disabled {% endif %}>
                      -
                    </button>

                    <div class="progress_count">{{ media.progress }}</div>

                    <button type="button" class="btn progress-btn border-0" data-operation="increase"
                            data-type="{{media_type}}" data-id="{{media.media_id}}"
                            {% if media.season_number != None %} data-season-number="{{media.season_number}}" {% endif %}>
                      +
                    </button>
                  </div>
                </div>                
              </div>

            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

{% endblock content%}

{% block extra_scripts %}
  <script src="{% static "js/lazysizes.min.js" %}" async=""></script>
  <script>
    // Set the csrf token for ajax requests in progress-edit.js
    var csrftoken = '{{ csrf_token }}';
  </script>
  <script src="{% static 'js/progress-edit.js' %}"></script>
{% endblock extra_scripts %}