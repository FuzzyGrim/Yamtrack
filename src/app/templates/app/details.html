{% extends "base.html" %}
{% load static %}

{% block content %}
  <div id="details" class="content">
    <div class="header d-flex">
      <div class="image">
        {% if media.image != "none.svg" %}
          <img class="poster" src="{{media.image}}"/>
        {% else %}
          <img class="image-not-found" src="{% get_media_prefix %}{{media.image}}"/>
        {% endif %}
      </div>
      <div class="content flex-fill">
        <div class="title">{{media.title}}</div>

        <div class="start-date">
          <strong>Release date:</strong>
          {{media.start_date}}
        </div>

        <div class="status">
          <strong>Status:</strong> {{media.status}} 
        </div>

        <div class="synopsis">
          <strong>Synopsis:</strong>
          {{media.synopsis}}
        </div>

        {% if media.number_of_seasons %}
        <div class="num_seasons">
          <strong>Seasons:</strong> {{media.number_of_seasons}}
        </div>
        {% endif %}

        <div class="episodes">
          {% if media.num_episodes %} <strong>Episodes:</strong> {{media.num_episodes}}
          {% elif media.num_chapters %} <strong>Chapters:</strong> {{media.num_chapters}}
          {% endif %}
        </div>

        <div class="runtime">
          <strong>Runtime:</strong> {{media.runtime}}
        </div>

        <div class="genres">
          <strong>Genres:</strong>
          {% for genre in media.genres %}
              {{ genre.name }}{% if not forloop.last %},{% endif %}
          {% endfor %}
        </div>
        
        <div class="media-form">
          <button type="button" class="btn open-modal-button" data-bs-toggle="modal" data-bs-target="#modal-{{media.media_type}}_{{media.media_id}}" data-url="{{media.media_type}}_{{media.media_id}}">
            <i class="bi bi-pencil-square"></i>
          </button>
          {% include "app/include/modal.html" with title=media.title media_id=media.media_id media_type=media.media_type csrf_token=csrf_token only %}
        </div>
      </div>
    </div>

    {% for related_data in related_data_list %}
      {% if related_data.data %}

        <div class="grid-title">
          <strong>{{ related_data.name }}</strong>
        </div>

        <div class="grid">
          {% for related in related_data.data %}
            <div class="card text-bg-dark mx-auto">
              <img
                {% if related.image == "none.svg"%}
                  src="{% get_media_prefix %}{{related.image}}"
                  class="card-img image-not-found"
                  {% else %}
                  src="{{related.image}}"
                  class="card-img poster"
                {% endif %}
                alt="{{ related.title }}"
                loading="lazy"
              />

              <div class="card-img-overlay">
                <div class="card-title text-center">
                  {{ related.title }}
                </div>

                <div class="card-text d-flex justify-content-center align-items-center">
                  
                  <button type="button" class="btn open-modal-button" data-bs-toggle="modal" data-bs-target="#modal-{{media.media_type}}_{{related.id}}" data-url="{{media.media_type}}_{{related.id}}">
                    <i class="bi bi-pencil-square"></i>
                  </button>
          
                  {% include "app/include/modal.html" with title=related.title media_id=related.id media_type=media.media_type csrf_token=csrf_token only %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

      {% endif %}
    {% endfor %}

  </div>
{% endblock content%}

{% block extra_scripts %}
  <script src="{% static 'js/modal-load.js' %}"></script>
{% endblock extra_scripts %}