{% extends "base.html" %}
{% load static %}

{% block content %}

  <div id="search">
      
    {% if query_list|length == 0 or "error" in query_list %}
      <h2 class="alert-heading">No results found!</h2>
      <p>Try searching for something else.</p>
    {% else %}
      <div class="container-grid">
        {% for media in query_list %}
          {% if media.media_type == "tv" or media.media_type == "movie" or media.media_type == "anime" or media.media_type == "manga" %}
           
            <div class="card">
              <a href="{% url 'details' media.media_type media.id media.title.split|join:"_"|cut:"/"|urlencode %}">
                {% if media.main_picture.large %}
                  <img class="poster flex-shrink-0 card-img-top" src="{{media.main_picture.large}}"/>  
                {% elif media.poster_path %}
                  <img class="poster flex-shrink-0 card-img-top" src="https://image.tmdb.org/t/p/w300{{media.poster_path}}"/>  
                {% else %}
                  <img class="image-not-found flex-shrink-0 card-img-top" src="{% get_media_prefix %}/none.svg"/>
                {% endif %}

                <div class="card-body">
                    <div class="card-title">{{media.title}}</div>
                    <div class="card-text">
                      {% if media.original_type == "tv" %}
                        TV
                      {% else %}
                        {{media.original_type|capfirst}}
                      {% endif %}
                    </div>
                </div>
              </a>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary open-modal-button" type="button" data-bs-toggle="modal" data-bs-target="#modal-{{media.media_type}}_{{media.id}}" data-url="{{media.media_type}}_{{media.id}}">
                <i class="bi bi-pencil-square"></i>
              </span>
            </div>
            
            {% include "app/include/modal.html" %}

          {% endif %}
              
        {% endfor %}
      </div>
    {% endif %}
  </div>

{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/modal-load.js' %}"></script>
  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>
{% endblock %}